{% extends 'common/base_ls.html' %}
{% block style %}
<style>

</style>
{% endblock %}

{% block content %}
<section id="list-section" class="container">
    <div>
        <h5>LS증권 계좌조회</h5>
        <div class="row">
            <div  id="summary-area" class="col-6 mt-3"></div>
            <div class="col-6"></div>
        </div>
        <div id="jango2-area"></div>
    </div> 
    <div>
        <h5>오늘의 미체결</h5>
        <div id="ccld-result-area" class="mt-3"></div>
    </div>
</section>

{% raw %} 
<script id="summary-table-template" type="text/x-handlebars-template">
    <table class="table table-sm">
        <tr>
            <th class="text-end">추정순자산</th><td class="text-end">{{displayWon item.sunamt}}</td>
            <th class="text-end">실현손익</th><td class="text-end">{{displayWon item.dtsunik}}</td>
            <th class="text-end">매입금액</th><td class="text-end">{{displayWon item.mamt}}</td>
        </tr>
        <tr>
            <th class="text-end">추정D2예수금</th><td class="text-end"><strong>{{displayWon item.sunamt}}</strong></td>
            <th class="text-end">평가손익</th><td class="text-end">{{displayWon item.tdtsunik}}</td>
            <th class="text-end">평가금액</th><td class="text-end">{{displayWon item.sunamt}}</td>
        </tr>
    </table>
</script>
<script id="jango2-table-template" type="text/x-handlebars-template">
    <h4>잔고</h4>
    <table class="table table-bordered table-hover">
        <thead>
            <tr class="table-primary">
                <th>종목명</th>
                <th class="text-center">종목번호</th>
                <th class="text-end">매도가능수량</th>
                <th class="text-end">평균단가</th>
                <th class="text-end">매입금액</th>
                <th class="text-end">평가금액</th>
                <th class="text-end">평가손익</th>
                <th class="text-end">수익율</th>
                <th class="text-end">수수료</th>
                <th class="text-end">제세금</th>
                <th class="text-center">동작</th>
            </tr>
        </thead>
        <tbody id="table-body">
            {{#each list}}
            <tr>
                <td class="">{{hname}}</td>
                <td class="text-center">{{expcode}}</td>
                <td class="text-end">{{displayWon mdposqt}}</td>
                <td class="text-end">{{displayWon pamt}}</td>
                <td class="text-end">{{displayWon mamt}}</td>
                <td class="text-end">{{displayWon appamt}}</td>
                <td class="text-end">{{displayWon dtsunik}}</td>
                <td class="text-end">{{sunikrt}}</td>
                <td class="text-end">{{displayWon fee}}</td>
                <td class="text-end">{{displayWon tax}}</td>
                <td class="text-center">
                    <button class="btn btn-sm btn-danger btnShowBuyCanvas" data-stk-code="{{expcode}}" data-stk-name="{{hname}}">매수</button>
                    <button class="btn btn-sm btn-primary btnShowSellCanvas"  data-stk-code="{{expcode}}" data-stk-name="{{hname}}" data-qty="{{mdposqt}}">매도</button>
                </td>
            </tr>
            {{/each}}                
        </tbody>
    </table>
</script>
{% endraw %}
{% endblock %}

{% block script %}
{% raw %}
<script>
    function initalize() {
        //계좌조회
        const url = '/api/v1/ls/jango2'
        getFetch(url).then(data => {
            console.log(data)
            const template = $('#jango2-table-template').html();
            const templateScript = Handlebars.compile(template);
            const html = templateScript({list: data.t0424OutBlock1});
            $('#jango2-area').html(html);
            const template1 = $('#summary-table-template').html();
            const templateScript1 = Handlebars.compile(template1);
            const html1 = templateScript1({item: data.t0424OutBlock});
            $('#summary-area').html(html1);
            
        }).catch(error => {
            console.error(error.message)
        })        

    };        
    
    $( document ).ready(function() {
        console.log('ready.... ');
        //매수 버튼
        $('#jango2-area').on('click', '.btnShowBuyCanvas', function(e) {
            e.preventDefault();
            console.log('btnBuySellCanvas click.... ');
            const stk_code = $(this).data('stk-code');
            const stk_name = $(this).data('stk-name');
            const qty = $(this).data('qty');
            showBuySellCanvas('LS',stk_code, stk_name, "매수", qty, 0);
        });
        //매도 버튼
        $('#jango2-area').on('click', '.btnShowSellCanvas', function(e) {
            e.preventDefault();
            console.log('btnShowSellCanvas click.... ');
            const stk_code = $(this).data('stk-code');
            const stk_name = $(this).data('stk-name');
            const qty = $(this).data('qty');
            showBuySellCanvas('LS',stk_code, stk_name, "매도", qty, 0);
        });

        initalize();

    });
    </script>	    
{% endraw %}
{% endblock %}