{% extends 'common/base.html' %}
{% block style %}
{% endblock %}
{% block content %}
<h2 class="mb-4">서비스 받을 회사 등록 및 키 발급</h2>
<div id="display-area">
    <form>
        <!-- Company ID -->
        <div class="mb-3">
            <label for="company_id" class="form-label">Company ID</label>
            <input type="number" class="form-control" id="company_id" name="company_id" placeholder="Enter Company ID" required>
            <div class="form-text fst-italic">Please enter a unique identifier for the company.</div>
        </div>

        <!-- Service Name (Select Box) -->
        <div class="mb-3">
            <label for="service_nm" class="form-label">Service Name</label>
            <select class="form-select" id="service_nm" name="service_nm" required>
                <option value="법률서비스">법률서비스</option>
            </select>
            <div class="form-text fst-italic">Select the service provided by the company.</div>
        </div>

        <!-- Start Date -->
        <div class="mb-3">
            <label for="start_ymd" class="form-label">Start Date</label>
            <input type="date" class="form-control" id="start_ymd" name="start_ymd" required>
            <div class="form-text fst-italic">Please select the service start date.</div>
        </div>

        <!-- End Date -->
        <div class="mb-3">
            <label for="end_ymd" class="form-label">End Date</label>
            <input type="date" class="form-control" id="end_ymd" name="end_ymd" value="9999-12-31">
            <div class="form-text fst-italic">Select the service end date (default: no end date).</div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary" >등록 및 키발급</button>
    </form>

</div>

{% raw %}
<!--handlebar scripts-->
<script id="register-result-template" type="text/x-handlebars-template">
    <table>
        <tr>
            <th>회사 ID</th>
            <td>{{company_id}}</td>
        </tr>
        <tr>
            <th>서비스명</th>
            <td>{{service_nm}}</td>
        </tr>
        <tr>
            <th>시작일</th>
            <td>{{start_ymd}}</td>
        </tr>
        <tr>
            <th>종료일</th>
            <td>{{end_ymd}}</td>
        </tr>
        <tr>
            <th>APP KEY</th>
            <td>{{app_key}}</td>
        </tr>
        <tr>
            <th>APP SECRET KEY</th>
            <td>{{app_secret_key}}</td>
        </tr>
    </table>
    <div class="">
        <ul>
            <li>APP KEY와 APP SECRET KEY는 웹상에서 또는 허가받지 않은 인원에 대해서 노출되지 않게 주의해 주십시오.</li>
            <li>특히 APP SECRET KEY는 한국펀드서비스에서도 보관되지 않습니다.</li>
        </ul>
    </div>
    <div>
        <button class="btn btn-secondary" onclick="location.href='/page?path=company/list'">리스트로 이동</button>
    </div>
</script>
{% endraw %}
{% endblock %}
{% block script %}
{% raw %}
<script>
$( document ).ready(function() {
    console.log( "회사등록 ready!")
    document.getElementById('start_ymd').valueAsDate = new Date();
    //form의 submit 이벤트를 처리한다.
    $('form').submit(function(e){
        e.preventDefault();
        var company_id = $('#company_id').val();
        var service_nm = $('#service_nm').val();
        var start_ymd = $('#start_ymd').val().replace(/\D/g, '');
        var end_ymd = $('#end_ymd').val().replace(/\D/g, '')
        const url = '/api/v1/company/register';
        const data = { company_id : company_id, service_nm : service_nm, start_ymd : start_ymd, end_ymd : end_ymd};
        console.log(data)
        postFetch(url, data).then(response => {
            console.log(response);
            const html = makeHtmlWithTemplate('register-result-template', response);
            $('#display-area').html(html);
        }).catch(error=> {
            console.error(error);
            showAlertError(error, true);
        });

    });
});
</script>
{% endraw %}
{% endblock %}