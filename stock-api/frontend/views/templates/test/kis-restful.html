{% extends 'common/base.html' %}
{% block style %}
<style>
.log {
    height: 400px;
    overflow-y: scroll;
    border: 1px solid #ccc;
    padding: 10px;
}
input {
    width:120px;
}
</style>

{% endblock %}
{% block content %}
<h1>KIS-Restful API Test</h1>
<div class="bg-secondary m-2 p-2">
    user id: <input type="text" id="user_id" value="kdy987">
    account no : <input type="text" id="acct_no" value="6577792801">
</div>
<div>
    stk_code : <input type="text" id="stk_code" value="005930"> 
    <button id="btnCurrentCost">현재가</button>
</div>
<div>
    stk_code : <input type="text" id="stk_code1" value="005930">
    qty : <input type="number"  id="qty1" value="1">
    cost : <input type="number"  id="cost1" value="0">
    <button id="btnBuy">매수</button>
    <button id="btnSell">매도</button>
</div>
<div>
    stk_code : <input type="text" id="stk_code2" value="005930"> 
    <button id="btnStockInfo">상품정보</button>
</div>
<div>
    <button id="btnInquireBalance">주식잔고</button>
</div>

<div id="log" class="log"></div><div id="error-area" class="text-danger"></div>
{% endblock %}

{% block script %}
{% raw %}
<script>
$( document ).ready(function() {
    console.log( "ready!")
    $('#btnCurrentCost').on('click', function(){
        var user_id = $('#user_id').val();
        var acct_no = $('#acct_no').val();
        var stk_code = $('#stk_code').val();
        var url = '/api/v1/kis/current-cost/'+user_id+'/'+acct_no+'/'+stk_code;
        console.log(url);
        getFetch(url)
        .then(
            response => {
                console.log(response);
                $('#log').append(JSON.stringify(response) + '<br>');
            }
        )
        .catch(
            error => {
                console.error(error.message);
                $('#error-area').append(error.toString()) + '<br>';
            }
        );
    });
    $('#btnBuy').on('click', function(){
        const user_id = $('#user_id').val();
        const acct_no = $('#acct_no').val();
        const stk_code = $('#stk_code1').val();
        const qty = $('#qty1').val();
        const cost = $('#cost1').val();
        const url = '/api/v1/kis/order/'+user_id+'/'+acct_no;
        
        const data = {
            buy_sell_gb :"매수",
            user_id: user_id,
            acctno: acct_no,
            stk_code: stk_code,
            qty: qty,
            cost: cost
        }

        console.log(url);
        postFetch(url, data)
        .then(
            response => {
                console.log(response);
                $('#log').append(JSON.stringify(response) + '<br>');
            }
        )
        .catch(
            error => {
                console.error(error.message);
                $('#error-area').append(error.toString()) + '<br>';
            }
        );
    });
    $('#btnSell').on('click', function(){
        const user_id = $('#user_id').val();
        const acct_no = $('#acct_no').val();
        const stk_code = $('#stk_code1').val();
        const qty = $('#qty1').val();
        const cost = $('#cost1').val();
        const url = '/api/v1/kis/order/'+user_id+'/'+acct_no;
        
        const data = {
            buy_sell_gb :"매도",
            user_id: user_id,
            acct_no: acct_no,
            stk_code: stk_code,
            qty: qty,
            cost: cost
        }

        console.log(url);
        postFetch(url, data)
        .then(
            response => {
                console.log(response);
                $('#log').append(JSON.stringify(response) + '<br>');
            }
        )
        .catch(
            error => {
                console.error(error.message);
                $('#error-area').append(error.toString()) + '<br>';
            }
        );
    });
    $('#btnStockInfo').on('click', function(){
        var user_id = $('#user_id').val();
        var acct_no = $('#acct_no').val();
        var stk_code = $('#stk_code2').val();
        var url = '/api/v1/kis/stock-info/'+user_id+'/'+acct_no+'/'+stk_code;
        console.log(url);
        getFetch(url)
        .then(
            response => {
                console.log(response);
                $('#log').append(JSON.stringify(response) + '<br>');
            }
        )
        .catch(
            error => {
                console.error(error.message);
                $('#error-area').append(error.toString()) + '<br>';
            }
        );
    });
    $('#btnInquireBalance').on('click', function(){
        const user_id = $('#user_id').val();
        const acct_no = $('#acct_no').val();
        getFetch(`/api/v1/kis/inquire-balance/${user_id}/${acct_no}`)
        .then(
            response => {
                console.log(response);
                $('#log').append(JSON.stringify(response) + '<br>');
            }
        )
        .catch(
            error => {
                console.error(error.message);
                $('#error-area').append(error.toString()) + '<br>';
            }
        );
    })
}); //end document ready
</script>
{% endraw %}
{% endblock %}