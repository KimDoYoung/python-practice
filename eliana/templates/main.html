<!DOCTYPE html>
<html>
<head>
<!-- =================================================== -->
{% include 'common/meta-css.html' %}
<!-- =================================================== -->
<style>
.container-flex {
    display: flex;
}

.main-content {
    flex-grow: 1;
    width : 100%;
}
.nav-link:hover {
    background-color: #0056b3; /* active 상태의 배경색과 유사한 색 */
    color: white; /* 텍스트 색상 */
}

/* 선택된 .nav-link에 대한 스타일 */
.nav-link.active {
    background-color: #007bff; /* Bootstrap에서 기본적으로 사용하는 active 상태의 배경색 */
    color: white;
}
</style>
<title>Eliana-chart maker</title>
</head>
<body>
    <div class="container-flex">
        {% include 'common/left-menu.html' %}
        <div class="main-content">
            <main class="container text-center">
                <h1 id="chartTypeName"></h1>
                <div class="row">
                    <div class="col-6 form-area left-side bg-light"></div>
                    <div class="col-6 chart-area right-side"></div>
                </div>
            </main>
        </div>
    </div>
<!-- =================================================== -->
{% include 'common/footer.html' %}
<!-- -================================================== -->
<script>
$( document ).ready(function() {
    console.log('ready...');
    $('.nav-link').on('click', function(e) {
        e.preventDefault(); // 링크의 기본 동작을 방지합니다.
        $('.nav-link').removeClass('active'); // 모든 nav-link에서 active 클래스를 제거합니다.
        $(this).addClass('active'); // 클릭된 nav-link에만 active 클래스를 추가합니다.
        var chartType = $(this).data('chart-type');
        fetchFormAndDisplay(chartType);
    });    
    function fetchFormAndDisplay(chartType){
        
        console.log(chartType)
        var url = `form/${chartType}`;
        JuliaUtil.ajax(url, null, {
            method: 'GET',
            success: function(response) {
                console.log(response);
                var handlebar_template = response.template;
                var handlebar_function = Handlebars.compile(handlebar_template);
                var html = handlebar_function(response.data);
                $('#chartTypeName').text(response.data.chartTypeName);
                $('.left-side').html(html);
            }
        });        
    }
    $('.main-content').on('submit', '.form-area form', function(event) {
        event.preventDefault(); // Prevent the default form submission behavior
        
        var formData = {
            user_id :'kdy97',
            width: parseInt($('#width').val(), 10),
            height: parseInt($('#height').val(), 10),
            chart_type: $('#chart_type').val(),
            title: $('#title').val(),
            x_data: $('#x_data').val().split(',').map(Number),
            y_data: $('#y_data').val().split('\n').map(function(line) { return line.split(',').map(Number); }),
            x_label: $('#x_label').val(),
            y_label: $('#y_label').val(),
            line_colors: [$('#line_color').val()], // 예제에는 다중 색상 처리 방법이 명시되어 있지 않아 단일 색상으로 처리
            line_styles: [$('#line_style').val()], // 예제에는 다중 스타일 처리 방법이 명시되어 있지 않아 단일 스타일로 처리
            line_widths: [parseFloat($('#line_width').val())], // 예제에는 다중 두께 처리 방법이 명시되어 있지 않아 단일 두께로 처리
            legend_labels: [$('#legend_label').val()], // 예제에는 다중 범례 처리 방법이 명시되어 있지 않아 단일 범례로 처리
            axis_range: $('#axis_range').val().split(',').map(Number),
            marker_styles: [$('#marker_style').val()], // 예제에는 다중 마커 스타일 처리 방법이 명시되어 있지 않아 단일 스타일로 처리
            grid: $('#grid').val() === "true",
            text_labels: $('#text_labels').val().split(',').map(function(item) { return item.split(',').map(function(value, index) { return index < 2 ? parseFloat(value) : value; }); })
        };
        formData ={
            "user_id" : "kdy987",
  "result_type": "url",
  "chart_type": "line",
  "width": 800,
  "height": 600,
  "title": "Line Chart 샘플",
  "x_data": [1.0, 2.0, 3.0, 4.0, 5.0],
  "y_data": [
    [2.0, 4.0, 6.0, 8.0, 10.0],
    [3.0, 6.0, 9.0, 12.0, 15.0]
  ],
  "x_label": "X-axis",
  "y_label": "Y-axis 온도축",
  "line_colors": ["blue", "red"],
  "line_styles": ["solid", "dashed"],
  "line_widths": [2.0, 1.5],
  "legend_labels": ["Data 1", "Data 2"],
  "axis_range": [[0.0, 6.0], [0.0, 16.0]],
  "marker_styles": ["o", "s"],
  "grid": true,
  "text_labels": [
    [
      [2.0, 4.0, "Point 2, 4"],
      [4.0, 8.0, "Point 4, 8"]
    ],
    [
      [2.0, 6.0, "Point 2, 6"],
      [4.0, 12.0, "Point 4, 12"],
      [5.0, 10.0, "확인!"]
    ]
  ]
}
;
        // JSON 객체를 콘솔에 출력합니다.
        console.log(JSON.stringify(formData));
        var url = $(this).attr('action');
    
        // Using JuliaUtil.ajax to send the data
        JuliaUtil.ajax(url, formData, {
            method: "POST", // Specify the method
            success: function(response, status, xhr) {
                console.log("Success", response);
                var url = response.url;
                $('.main-content').find('.chart-area').empty().append(`<img src="${url}"/>`);
            },
            error: function(xhr, status, error) {
                console.error("Error", error);
            }
        });
    });


});
</script>	
</body>
</html>